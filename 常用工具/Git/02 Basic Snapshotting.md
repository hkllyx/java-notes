- [基本快照](#基本快照)
  - [git add](#git-add)
  - [git commit](#git-commit)
  - [git diff](#git-diff)
  - [git mv](#git-mv)
  - [git reset](#git-reset)
  - [git rm](#git-rm)
  - [git status](#git-status)

# 基本快照

## git add

将将文件内容暂存到索引（暂存区域）。

```
git add [option] [--] [<pathspec> ...]
```

pathspec：指定的文件路径。可以使用 Golb 模式匹配多个文件，也可以只使用 `.` 表示所有文件。此外也可以使用目录开头指定该目录下的文件。

| Glob 通配符 | 说明                               | 示例         |
| ----------- | ---------------------------------- | ------------ |
| `?`         | 匹配任意字符一次                   | Gl?b         |
| `*`         | 匹配任意字符任意次（包括 0 次）    | *.java       |
| `[...]`     | 匹配括号中指定字符或指定范围内字符 | [abc], [a-z] |

[Glob](https://en.wikipedia.org/wiki/Glob_%28programming%29)

常用选项：

| 选项              | 说明                                              |
| ----------------- | ------------------------------------------------- |
| -n, --dry-run     | 实际上不添加文件，仅显示它们是否存在和/或将被忽略 |
| -v, --verbose     | 显示详细信息                                      |
| -f, --force       | 允许添加被忽略的文件                              |
| -i, --interactive | 以交互方式将工作树中的修改内容添加到索引          |
| -e, --edit        | 在编辑器中打开差异与索引，然后让用户对其进行编辑  |

交互模式（interactive mode）：当使用 `-i` 选项进入交互模式时，它显示 status 子命令的输出，然后进入交互式命令循环。命令循环显示可用的子命令列表，并提示 “What now>”。

编辑补丁（editing patches）：调用 `git add -e` 从交互式外观选择器中选择 `e` 将在您的编辑器中打开一个修补程序。

- 添加内容：添加的内容由以 “+” 开头的行表示。您可以通过删除它们来防止暂存任何附加行。
- 删除内容：删除的内容由以 “-” 开头的行表示。您可以通过将 “ - ” 转换为 “”（空格）来阻止他们的移除。
- 修改的内容：修改的内容由 “-” 行（删除旧内容），后跟 “+” 行（添加替换内容）表示。可以通过将 “-” 行转换为 “” 并去除 “+” 行来阻止修改。请注意，只修改这一对的一半可能会对索引造成令人困惑的更改。

例如：

```
$ echo '# Test' >> README.md # 将 '# Test' 写入 README.md 文件中
$ git add .                  # 将所有文件添加到索引
```

## git commit

提交索引中的修改。

```
git commit [option] [--] [<file> ...​]
```

常用选项

| 选项                        | 说明                                                                              |
| --------------------------- | --------------------------------------------------------------------------------- |
| -a, --all                   | 告诉命令自动暂存已修改和删除的文件，但是未告知 Git 的新文件不受影响               |
| -m \<msg>, --message=\<msg> | 使用给定的 msg 作为提交消息。如果给出了多个 -m 选项，则它们的值将串联为单独的段落 |
| -F \<file>, --file=\<file>  | 从指定文件中获取信息作为提交信息。使用 “-” 从标准输入读取信息                     |
| --amend                     | 通过创建一个新的提交替换当前分支的提示（修改当前分支的上一个提交的提交信息）  |

示例：

```
$ git commit -m 'initial commit.'
[master (root-commit) c4bff0c] initial commit.
 1 file changed, 1 insertion(+)
 create mode 100644 README.md
```

## git diff

显示文件的变更以及文件之间的差异等。

```
git diff [options] [<action>]
```

操作：

| 操作                                   | 说明                                                                                                                                     |
| -------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| [--] [\<path>...]                      | 查看索引和工作树之间的差异。path 被用来将 diff 限制在指定路径(给目录并且获取改目录下所以文件的差异)                                      |
| --no-index [--] \<path> \<path>        | 此表单用于比较文件系统上给定两条路径的文件                                                                                               |
| --cached [\<commit>] [--] [\<path>...] | 查看索引和指定提交之间的差异。如果提交未指定，则比较索引和 HEAD；若 HEAD 也不存在，将显示索引所有变化。--cached 和 --staged 同义 |
| \<commit> [--] [\<path>...]            | 比较提交和工作树的差异，可以使用 HEAD 表示最后一个提交；也可以使用分支名比较不同分支的最后一个提交                            |
| \<commit> \<commit> [--] [\<path>...]  | 比较任意两个提交                                                                                                                     |

示例：

```
$ echo '# balabala' >> README.md  # 向 README.md 中添加一行新内容
$ git diff HEAD                    # 查看最后一个提交和工作树中的差异
diff --git a/README.md b/README.md # 列出比较的两个文件
index 8ae0569..5b61527 100644
--- a/README.md
+++ b/README.md
@@ -1 +1,2 @@
 # Test
+# balabala                       # "+" 表示新增的一行，相应的，"-" 表示删除的一行
```

## git mv

移动或重命名文件，目录或符号链接。

```
git mv <options>...​ <args>...
```

常用选项：

| 选项          | 说明                                                                                                                       |
| ------------- | -------------------------------------------------------------------------------------------------------------------------- |
| -f, --force   | 即使目标存在，也强制重命名或移动文件                                                                                       |
| -k            | 跳过移动或重命名可能导致错误情况的动作。当源文件既不存在也不不受 Git 控制时，或者覆盖源文件（除非给出 -f）时，都会发生错误 |
| -n, --dry-run | 不做什么，只显示会发生什么                                                                                                 |
| -v, --verbose | 报告移动文件的名称                                                                                                         |

常用参数

| 参数             | 说明               |
| ---------------- | ------------------ |
| \<src> \<dest>   | 重命名             |
| \<src>... \<dir> | 移动文件到指定目录 |

示例：

```
$ git mv README.md README.txt # 重命名 README.md 文件为 README.txt
```

## git reset

将当前 HEAD 重置为指定状态。

```
git reset [<action>]
```

常用操作：

| 操作                                | 说明                                                                                 |
| ----------------------------------- | ------------------------------------------------------------------------------------ |
| [-q] [\<tree-ish>] [--] \<paths>... | 将所有 paths 指定的索引项重置为 tree-ish 的状态(不影响工作树或当前分支)              |
| [\<mode>] [\<commit>]               | 此表单将当前分支头重置为指定提交，并可能更新索引和工作树，具体取决于 mode(见下文) |

reset 模式

| 模式    | 说明                                                                                                                                                                           |
| ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| --soft  | 完全不触及索引文件或工作树(但将 HEAD 重置为指定提交，就像所有模式所做的那样)。这将使所有更改的文件“Changes to be committed”，就像“git status”所表示的那样                   |
| --mixed | 重置索引，但不重置工作树(即，已更改的文件被保留，但未标记为提交)，并报告未更新的内容。这是省缺模式                                                                             |
| --hard  | 重置索引和工作树。自指定提交之后对工作树中跟踪文件的任何更改都将被丢弃                                                                                                     |
| --merge | 重新设置索引并更新工作树中指定提交和 HEAD 中不同的的文件，但保留不同于索引和工作树中的文件(即有未添加的更改)。如果指定提交和索引之间的文件有未暂存的更改，则重置将中止 |
| --keep  | 重置工作树中指定提交和 HEAD 之间不同的索引项和更新文件。如果指定提交和 HEAD 之间的文件有局部更改，则重置将中止                                                         |

使用 HEAD 和 "^"，"~"，"[]" 撤销提交。

| 符号 | 说明                     | 示例，撤销最后 3 次提交（需要保证提交次数大于 3） |
| ---- | ------------------------ | -------------------------------------------------------- |
| ^    | 撤销 "^" 的个数次提交| git reset --hard HEAD^^^                                 |
| ~n   | 撤销指定数值次提交   | git reset --hard HEAD~3                                  |
| [id] | 撤销到指定 HEAD          | git reset --hard HEAD[倒数第四个提交的 id]           |

示例：

```
$ git commit -a -m 'Something changed.'          # 先增加一次提交
[master 631b2a7] Something changed.              # 提交信息，当前 HEAD 从 c4bff0c 变为 631b2a7
 2 files changed, 2 insertions(+), 1 deletion(-)
 delete mode 100644 README.md
 create mode 100644 README.txt
$ git reset --hard HEAD^                         # 撤销一次提交，同时撤销工作树和索引的变化
HEAD is now at c4bff0c initial commit.           # HEAD 变回 c4bff0c
```

## git rm

从工作树和索引中移除指定文件。

```
git rm [option] [--] <file>...
```

常用选项：

| 选项             | 说明                                                                               |
| ---------------- | ---------------------------------------------------------------------------------- |
| -f, --force      | 覆盖最新的检查                                                                     |
| -n, --dry-run    | 实际上不移除文件。相反，只需显示它们是否存在于索引中，否则将被命令删除             |
| -r               | 当给出一个主目录时，递归删除其子文件和子目录                                       |
| --               | 此选项可用于将命令行选项与文件列表分开（当文件名可能被误认为是命令行选项时很有用） |
| --cached         | 使用此选项仅从索引中取消暂存和删除路径，工作树文件不管是否修改都将保持不变         |
| --ignore-unmatch | 即使没有匹配的文件，也可以用零状态退出                                             |
| -q, --quiet      | 通常 git rm 命令为每个被删除的文件输出一行信息，使用此选项禁止输出                 |

示例：

```
$ git rm README.md # 从工作树和索引中移除 README.md 文件
rm 'README.md'
```

## git status

显示索引文件和当前 HEAD 提交之间存在差异的路径，工作树和索引文件之间存在差异的路径，以及工作树中未由 Git 跟踪的路径（并且不会被 gitignore 忽略） ）。

```
git status [<options>...] [--] [<pathspec>...]
```

常用选项：

| 选项                                     | 说明                           |
| ---------------------------------------- | ------------------------------ |
| -s, --short                              | 以短格式输出输出               |
| -b, --branch                             | 以短格式显示分支和跟踪信息     |
| --show-stash                             | 显示当前隐藏的条目数量         |
| --long                                   | 以长格式输出输出。这是默认设置 |
| --ignored                                | 显示忽略文件                   |
| -z                                       | 以 NULL 字节而非 LF 结尾       |
| -u[\<mode>], --untracked-files[=\<mode>] | 显示未跟踪的文件               |

-u 选项的 mode：

| mode   | 说明                         |
| ------ | ---------------------------- |
| no     | 不显示未跟踪文件             |
| normal | 显示未跟踪文件和目录         |
| all    | 还显示未跟踪目录中的单个文件 |

短格式：在短格式中，每个路径的状态显示为

```
XY PATH1 -> PATH2
```

- PATH1 表示 HEAD 中的路径。
- PATH2 表示工作树 / 索引中相应变化的路径。
- XY 表示两个字符的状态码。

状态码：对于具有合并冲突的路径，X 和 Y 显示合并每一侧的修改状态。对于没有合并冲突的路径，X 显示索引的状态，Y 显示工作树的状态。

| X（索引状态）             | Y（工作树状态） | 说明                   |
| ------------------------- | --------------- | ---------------------- |
| ' '（Space）              | [MD]（M 或 D）  | 未更新                 |
| M（Modified）             | [ MD]           | 在索引中更新           |
| A（Add）                  | [ MD]           | 添加到索引             |
| D（Deleted）              | [ M]            | 从索引中删除           |
| R（Renamed）              | [ MD]           | 在索引中重命名         |
| C（Copied）               | [ MD]           | 在索引中复制           |
| [MARC]                    |                 | 索引和工作树匹配       |
| [ MARC]                   | M               | 自索引以来工作树已更改 |
| [ MARC]                   | D               | 在工作树中删除         |
| D                         | D               | 未合并，均已删除       |
| A                         | U               | 未合并，由我们添加     |
| U（Updated but Unmerged） | D               | 未合并，被他们删除     |
| U                         | A               | 未合并，由他们添加     |
| D                         | U               | 未合并，由我们删除     |
| A                         | A               | 未合并，均已添加       |
| U                         | U               | 未合并，均已修改       |
| ?                         | ?               | 未追踪                 |
| !                         | !               | 被忽略                 |


示例：

```
$ git status                                    # 长格式
# On branch master
# Changes to be committed:
#   (use "git reset HEAD <file>..." to unstage)
#
#	deleted:    README.md
#
$ git status -s                                 # 短格式
D  README.md
```